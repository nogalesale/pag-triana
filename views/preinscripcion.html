<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulario de Inscripci√≥n</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <header class="header">
    <a href="/" class="logo">Sistema de inscripci√≥n</a>
  </header>

  <main class="form-container">
    <h1>Formulario de Inscripci√≥n</h1>
    <p>Completa los datos para iniciar tu inscripci√≥n.</p>

    <!-- NUEVO P√ÅRRAFO SOBRE PAGO -->
    <p class="nota-pago">
      Si tu inscripci√≥n fue aceptada, puedes pagar en l√≠nea y enviar tus datos.
    </p>

    <form id="formPreinscripcion" novalidate>
      <h3>Datos del estudiante</h3>
      <div class="form-grid">
        <label>
          Nombres
          <input type="text" name="nombres" required />
        </label>
        <label>
          Apellidos
          <input type="text" name="apellidos" required />
        </label>
        <label>
          C√©dula de identidad
          <input type="text" name="ci" required />
        </label>
        <label>
          Fecha de nacimiento
          <input type="date" name="fecha_nac" required />
        </label>
        <label>
          G√©nero
          <select name="genero" required>
            <option value="">Selecciona g√©nero</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
          </select>
        </label>
        <label>
          Curso al que postula
          <select name="grado" required>
            <option value="">Selecciona el curso</option>
            <optgroup label="Nivel Inicial">
              <option value="Prek√≠nder">Prek√≠nder</option>
              <option value="K√≠nder">K√≠nder</option>
            </optgroup>
            <optgroup label="Primaria">
              <option value="1ro de Primaria">1ro de Primaria</option>
              <option value="2do de Primaria">2do de Primaria</option>
              <option value="3ro de Primaria">3ro de Primaria</option>
              <option value="4to de Primaria">4to de Primaria</option>
              <option value="5to de Primaria">5to de Primaria</option>
              <option value="6to de Primaria">6to de Primaria</option>
            </optgroup>
            <optgroup label="Secundaria">
              <option value="1ro de Secundaria">1ro de Secundaria</option>
              <option value="2do de Secundaria">2do de Secundaria</option>
              <option value="3ro de Secundaria">3ro de Secundaria</option>
              <option value="4to de Secundaria">4to de Secundaria</option>
              <option value="5to de Secundaria">5to de Secundaria</option>
              <option value="6to de Secundaria">6to de Secundaria</option>
            </optgroup>
          </select>
        </label>
        <label>
          Direcci√≥n
          <input type="text" name="direccion" required />
        </label>
        <label>
          Tel√©fono del estudiante
          <input 
            type="tel" 
            name="telefono" 
            placeholder="+59171234567"
            pattern="^\+?[0-9]{8,15}$"
            required
          />
        </label>
        <label>
          Correo del estudiante
          <input type="email" name="email" placeholder="correo@ejemplo.com" />
        </label>
        <label>
          Unidad educativa de procedencia
          <input type="text" name="procedencia" />
        </label>
      </div>

      <h3>Datos del tutor</h3>
      <div class="form-grid">
        <label>
          Nombre del tutor
          <input type="text" name="t_nombre" required />
        </label>
        <label>
          Celular del tutor
          <input 
            type="tel" 
            name="t_cel" 
            placeholder="+59171234567"
            pattern="^\+?[0-9]{8,15}$"
            required
          />
        </label>
        <label>
          Parentesco
          <input type="text" name="t_parentezco" required />
        </label>
        <label>
          Correo del tutor
          <input type="email" name="t_email" placeholder="correo@ejemplo.com" />
        </label>
        <label>
          N√∫mero de emergencia
          <input 
            type="tel" 
            name="emergencia"
            placeholder="+59170000000"
            pattern="^\+?[0-9]{8,15}$"
            required
          />
        </label>
      </div>

      <button type="submit" class="btn">Enviar Inscripci√≥n</button>

      <p class="nota-whatsapp">
        Luego de enviar el formulario, comun√≠cate con nuestro asistente virtual para conocer el estado de tu solicitud.
      </p>

      <button type="button" class="btn-whatsapp" onclick="abrirWhatsApp()">
        üí¨ Habla con nuestro asistente virtual
      </button>
    </form>
  </main>

  <footer>
    <h3>U.E. Marcelino Champagnat</h3>
    <p>Una p√°gina hecha por estudiantes de la promo &copy; 2025</p>
  </footer>

  <script>
    const form = document.getElementById("formPreinscripcion");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const data = Object.fromEntries(new FormData(form).entries());

      const telefonos = ["telefono", "t_cel", "emergencia"];
      for (let campo of telefonos) {
        const valor = data[campo];
        const regex = /^\+?[0-9]{8,15}$/;
        if (!regex.test(valor)) {
          alert(`El campo "${campo}" no tiene un n√∫mero v√°lido. Ej: +59171234567`);
          return;
        }
      }

      try {
        const res = await fetch("/api/preinscripcion", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const result = await res.json();

        const mensajeExito = document.createElement("div");
        mensajeExito.textContent =
          result.message || "‚úÖ Formulario enviado con √©xito. ¬°Gracias por inscribirte!";
        mensajeExito.className = "mensaje-exito";
        document.body.appendChild(mensajeExito);
        setTimeout(() => mensajeExito.remove(), 3000);

        if (res.ok) form.reset();
      } catch (err) {
        alert("Ocurri√≥ un error al enviar el formulario. Intenta nuevamente.");
        console.error(err);
      }
    });

    function abrirWhatsApp() {
      const numero = "+14155238886";
      const mensaje = "join simplest-place";
      const url = `https://wa.me/${numero.replace("+","")}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, "_blank");
    }
  </script>
</body>
</html>
